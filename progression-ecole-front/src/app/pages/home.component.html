<div class="periode-select">
  <span>P√©riode :</span>
  @for (periode of ['P1','P2','P3','P4','P5']; track periode) {
    <label class="periode-label periode-{{periode}}">
      <input type="radio" name="periode" [value]="periode" [checked]="selectedPeriode() === periode" (change)="selectedPeriode.set(periode)" title="Choisir la p√©riode {{ periode }}" /> {{ periode }}
    </label>
  }
  <button class="save-btn secondary-btn" (click)="savePeriodeActivites()">Enregistrer</button>
  @if (notification()) {
    <div [ngClass]="notificationColor() === 'success' ? 'notif-success' : 'notif-error'">
      {{ notification() }}
    </div>
  }
</div>

<div class="generate-block">
  <button class="generate-btn" (click)="generateDocx()">G√©n√©rer le document pour tous les √©l√®ves</button>
</div>


<div class="status small-status" [ngClass]="status()">
  @if (status() === 'ko') {
    <span class="ko">Connexion KO</span>
  }
  @if (status() === null) {
    <span>V√©rification de la connexion...</span>
  }
</div>

<div class="eleve-select">
  <span>√âl√®ve :</span>
  <select [(ngModel)]="selectedEleve" title="S√©lectionner un √©l√®ve">
    <option [ngValue]="null">-- S√©lectionner un √©l√®ve --</option>
    @for (eleve of eleves(); track eleve.id) {
      <option [ngValue]="eleve.id">{{ eleve.nom }} {{ eleve.prenom }}</option>
    }
  </select>
  <style>
    .eleve-select {
      margin-bottom: 1.5rem;
    }
  </style>
</div>


@if (categories().length > 0) {
  <div class="tabs">
    @for (cat of categories(); track cat.id) {
      <button [ngClass]="{active: selectedTab() === cat.id}" (click)="selectedTab.set(cat.id)">{{ cat.libelle }}</button>
    }
  </div>

  <div class="tab-content">
    @if (selectedTab()) {
      @if (getActivitesForSelectedCategorie().length > 0) {
        <div class="activites-list">
          @for (activite of getActivitesForSelectedCategorie(); track activite.id) {
            <div class="activite-item" [ngClass]="getActiviteItemClass(activite)">
              @if (activite.estRegroupement) {
                <!-- Regroupement - non cochable -->
                <div class="regroupement-header">
                  <span class="regroupement-icon">üìÅ</span>
                  <span class="regroupement-label">{{ activite.libelleCourt }} - {{ activite.libelleLong }}</span>
                </div>
                <!-- Activit√©s enfants -->
                @for (enfant of getEnfantsForActivite(activite.id); track enfant.id) {
                  <div class="activite-enfant">
                    <span class="indent">‚îî‚îÄ</span>
                    <input type="checkbox" [id]="'activite-' + enfant.id" [value]="enfant.id" [(ngModel)]="selectedActivites[enfant.id]" title="S√©lectionner l'activit√© {{ enfant.libelleCourt }}" />
                    <label [for]="'activite-' + enfant.id" [ngClass]="getPeriodeForActivite(enfant.id) ? 'activite-highlight-' + getPeriodeForActivite(enfant.id) : ''">{{ enfant.libelleCourt }} - {{ enfant.libelleLong }}</label>
                  </div>
                }
              } @else if (!activite.parentId) {
                <!-- Activit√© isol√©e -->
                <input type="checkbox" [id]="'activite-' + activite.id" [value]="activite.id" [(ngModel)]="selectedActivites[activite.id]" title="S√©lectionner l'activit√© {{ activite.libelleCourt }}" />
                <label [for]="'activite-' + activite.id" [ngClass]="getPeriodeForActivite(activite.id) ? 'activite-highlight-' + getPeriodeForActivite(activite.id) : ''">{{ activite.libelleCourt }} - {{ activite.libelleLong }}</label>
              }
            </div>
          }
        </div>
      }
      @else {
        <div class="no-activite">pas d'activit√©s encore ...</div>
      }
    }
  </div>
}
